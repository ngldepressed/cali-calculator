<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cali-Biotech: Production Command</title>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-CDL3F645R2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-CDL3F645R2');
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        * { box-sizing: border-box; }
        html, body { width: 100%; margin: 0; padding: 0; overflow-x: hidden; }
        :root { --primary: #4c6fff; --potential: #00ffcc; --bg: #0b0b12; --card: #161621; --border: #2a2a3a; --danger: #ff4c4c; --text: #e0e0e0; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display:flex; flex-direction:column; align-items:center; padding:10px; margin:0; }
        .container { background:var(--card); padding:20px; border-radius:24px; width:100%; max-width:1300px; box-shadow:0 30px 60px rgba(0,0,0,0.8); border: 1px solid var(--border); transition: 0.3s; }
        .main-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
        .card { background: #1f1f2e; padding: 18px; border-radius: 16px; border: 1px solid #333; }
        .card h3 { margin-top: 0; color: var(--primary); font-size: 0.75em; text-transform: uppercase; margin-bottom: 12px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        label { display:block; margin-top:8px; font-size: 0.65em; color: #888; text-transform: uppercase; font-weight: bold;}
        input, select { width:100%; padding:10px; margin-top:4px; border-radius:8px; border:1px solid #333; background:var(--bg); color:white; font-size: 0.85em; }
        .inline-quad { display: grid; grid-template-columns: 1.2fr 0.8fr 0.8fr 1fr; gap: 5px; }
        .dashboard-row { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 20px; margin-top: 30px; align-items: start; }
        .analysis-panel { background:#1f1f2e; padding:20px; border-radius:20px; border: 1px solid #333; min-height: 450px; overflow-y: auto; position: relative;}
        .prepare-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(22, 22, 33, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; border-radius: 20px; text-align: center; }
        .btn-prepare { background: transparent; color: var(--potential); border: 2px solid var(--potential); padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 0.8em; letter-spacing: 2px; }
        .skill-bar-container { margin-bottom: 12px; }
        .skill-label { display: flex; justify-content: space-between; font-size: 0.75em; margin-bottom: 4px; font-weight: bold; }
        .bar-bg { background: #0b0b12; height: 8px; border-radius: 4px; overflow: hidden; border: 1px solid #333; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--potential)); transition: width 0.5s ease; }
        .blog-section { width: 100%; max-width: 1300px; margin-top: 40px; padding: 20px; border-top: 1px solid var(--border); text-align: left; }
        .blog-link { color: var(--potential); text-decoration: none; font-size: 0.8em; margin-right: 20px; }
        table { width: 100%; font-size: 0.75em; border-collapse: collapse; margin-top: 10px; color: #bbb; }
        th { color: var(--primary); text-align: left; padding: 10px; border-bottom: 1px solid #333; text-transform: uppercase; }
        td { padding: 10px; border-bottom: 1px solid #222; }

        /* Report Card Styling */
        #reportCard { background: #050505; border: 2px solid #00ffcc; padding: 25px; font-family: monospace; color: #fff; display: none; margin-top: 15px; border-radius: 12px;}

        @media (max-width: 1000px) { .dashboard-row { grid-template-columns: 1fr; } .container { width: 95%; } }
    </style>
</head>
<body onload="loadSavedData(); renderLogs();"> 

<div class="container" id="mainContainer">
    <nav style="padding: 15px; border-bottom: 1px solid #333; display: flex; justify-content: center; margin-bottom: 20px;">
        <a href="index.html" style="color: var(--primary); text-decoration: none; font-weight: bold; font-size: 0.8em; letter-spacing: 2px;">HOME</a>
    </nav>

    <h1 style="text-align:center; color:var(--primary); font-size:1.4em; letter-spacing:4px; margin-bottom: 20px;">CALI-BIOTECH COMMAND</h1>

    <div style="text-align: center; margin-bottom: 20px;">
        <select id="unitSystem" onchange="updateLabels(); analyze();" style="width: 220px; background: #1f1f2e; color: var(--primary); border: 1px solid var(--primary);">
            <option value="met">METRIC (KG / CM)</option>
            <option value="imp">IMPERIAL (LBS / FT-IN)</option>
        </select>
        <div style="margin-top:10px;">
            <label style="cursor:pointer;"><input type="checkbox" id="simMode" onchange="toggleSimMode()"> ACTIVATE BIOTEST SIMULATION</label>
        </div>
    </div>

    <div class="main-grid">
        <div class="card">
            <h3>Structure & Readiness</h3>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label id="wLabel">Weight (kg)</label><input type="number" id="weight" value="75" oninput="analyze();"></div>
                <div id="hMetric"><label>Height (cm)</label><input type="number" id="hCm" value="175" oninput="analyze();"></div>
                <div id="hImperial" style="display:none;"><label>Height (ft/in)</label>
                    <div style="display:flex; gap:5px;"><input type="number" id="hFt" value="5" oninput="analyze();"><input type="number" id="hIn" value="9" oninput="analyze();"></div>
                </div>
            </div>
            <label>Surface Stability</label>
            <select id="surface" onchange="analyze();"><option value="1.0">Stable (Floor)</option><option value="1.25">Unstable (Rings)</option></select>
            <label>CNS Readiness</label>
            <input type="range" id="cns" min="1" max="10" value="9" oninput="analyze();">
        </div>

        <div class="card">
            <h3>BW Basics & Skills</h3>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label>Max Pullups</label><input type="number" id="pullups" value="15" oninput="analyze();"></div>
                <div><label>Max Pushups</label><input type="number" id="pushups" value="35" oninput="analyze();"></div>
            </div>
            <div class="inline-quad" style="grid-template-columns: 1.2fr 0.8fr;">
                <div><label>Leg Inertia</label><select id="legRatio" onchange="analyze();"><option value="0.95">Short</option><option value="1.0" selected>Neutral</option><option value="1.1">Long/Heavy</option></select></div>
                <div><label>Form</label><select id="form" onchange="analyze();"><option value="1.0">Elite</option><option value="0.7">Piked</option></select></div>
            </div>
        </div>

        <div class="card">
            <h3>Weighted Matrix</h3>
            <label>Weighted Pull-up</label>
            <div class="inline-quad"><input type="number" id="wpW" value="25" oninput="analyze();"><input type="number" id="wpR" value="5" oninput="analyze();"><input type="number" id="wpS" value="3" oninput="analyze();"><input type="number" id="wpRPE" value="8" oninput="analyze();"></div>
            <label>Weighted Dip</label>
            <div class="inline-quad"><input type="number" id="wdW" value="35" oninput="analyze();"><input type="number" id="wdR" value="5" oninput="analyze();"><input type="number" id="wdS" value="3" oninput="analyze();"><input type="number" id="wdRPE" value="8" oninput="analyze();"></div>
            <label>Zanetti Raise (SA)</label>
            <div class="inline-quad"><input type="number" id="saW" value="12" oninput="analyze();"><input type="number" id="saR" value="8" oninput="analyze();"><input type="number" id="saS" value="3" oninput="analyze();"><input type="number" id="saRPE" value="9" oninput="analyze();"></div>
        </div>
    </div>

    <div class="dashboard-row">
        <div id="chart-card" style="background:var(--bg); border-radius:20px; padding:10px; border:1px solid var(--border); position: relative; min-height: 350px;">
            <div id="radar-lock" class="prepare-overlay">
                <button class="btn-prepare" onclick="prepareSystem()">PREPARE TRAINING MATRIX</button>
            </div>
            <canvas id="skillRadar"></canvas>
        </div>

        <div class="analysis-panel" id="skillBars">
             <div style="text-align: center; color: #444; margin-top: 100px;">SYSTEM OFFLINE</div>
        </div>

        <div class="analysis-panel">
            <div id="aiFeedback">
                <div style="text-align: center; color: #444; margin-top: 100px;">AWAITING AUDIT</div>
            </div>

            <div id="reportCard">
                <div style="border-bottom: 1px solid #333; padding-bottom: 10px; margin-bottom: 15px;">
                    <span style="color: #00ffcc; font-size: 0.6em; letter-spacing: 2px;">BIO_METRIC_ID // VERIFIED</span>
                    <h2 style="margin: 5px 0; font-size: 1.2em; text-transform: uppercase; color: #fff;">Athlete Report</h2>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                    <div><p style="font-size: 0.5em; color: #888; margin: 0;">LEVERAGE_TAX</p><p id="cardTax" style="font-size: 1.1em; color: #ff4444; margin: 0;">0%</p></div>
                    <div><p style="font-size: 0.5em; color: #888; margin: 0;">RELATIVE_POWER</p><p id="cardPower" style="font-size: 1.1em; color: #00ffcc; margin: 0;">0.0</p></div>
                </div>
                <div style="background: rgba(255,255,255,0.05); padding: 10px; border-left: 3px solid #00ffcc;">
                    <p id="cardRank" style="font-size: 0.7em; line-height: 1.4; margin: 0; color:#fff;">SYSTEM_CALIBRATING...</p>
                </div>
                <div style="text-align:right; margin-top:10px; font-size:0.5em; color:#444;">CALI-BIOTECH.COM</div>
            </div>
            <button id="shareBtn" onclick="shareReport()" style="display:none; width:100%; margin-top:10px; background:transparent; border:1px solid var(--potential); color:var(--potential); cursor:pointer; padding:12px; font-family: monospace; border-radius: 8px;">DOWNLOAD_REPORT.PNG</button>
        </div>
    </div>

    <div class="card" style="margin-top: 25px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h3>Training History Log</h3>
            <button onclick="logSession()" style="background:var(--primary); color:white; border:none; padding:8px 16px; border-radius:8px; cursor:pointer; font-size: 0.7em; font-weight: bold;">LOG SESSION</button>
        </div>
        <table>
            <thead><tr><th>Date</th><th>BW</th><th>Pull</th><th>Push</th><th>SA</th><th>Skill</th><th></th></tr></thead>
            <tbody id="logBody"></tbody>
        </table>
    </div>

    <h2 style="color:var(--primary); margin-top:40px; letter-spacing:2px; font-size:1em; text-align:center;">SUPPORT THE GRIND</h2>
    <div style="text-align: center; padding: 30px; background: #1f1f2e; border-radius: 20px; border: 1px dashed var(--primary); width: 100%; max-width: 1300px; box-sizing: border-box; margin: 20px auto;">
        <p style="font-size: 0.8em; color: #888; margin-bottom: 20px;">I'm refining these tools every day through my own training. If this data helps your progress, consider fueling the research.</p>
        <a href="https://www.buymeacoffee.com/CaliBiotech" target="_blank" style="display: inline-flex; align-items: center; background: #FFDD00; color: #000000; padding: 12px 24px; border-radius: 10px; text-decoration: none; font-weight: bold; font-size: 0.9em;">
            <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee" style="height: 20px; margin-right: 10px;">
            Buy me a protein shake
        </a>
    </div>

    <div class="blog-section">
        <h3 style="color:var(--primary); font-size:0.9em; margin-bottom: 15px;">RESOURCES & GUIDES</h3>
        <a href="blog/pullup-guide.html" class="blog-link">First Pull-up Guide</a>
        <a href="blog/privacy.html" class="blog-link">Privacy Policy</a>
        <a href="blog/about.html" class="blog-link">About Cali-Biotech</a>
        <a href="blog/contact.html" class="blog-link">Contact Us</a>
        <p style="font-size: 0.6em; color: #444; margin-top: 25px;">© 2026 Cali-Biotech Command Systems.</p>
    </div>
</div>

<script>
let isSystemReady = false;
let isSimMode = false;
let radarChart;
const ctx = document.getElementById('skillRadar').getContext('2d');

const skills = [
    { name: "Full Planche", p: 3.4, l: 0, s: 2.5 },
    { name: "Straddle Planche", p: 2.8, l: 0, s: 2.0 },
    { name: "Front Lever", p: 0, l: 2.6, s: 1.8 },
    { name: "Iron Cross", p: 0, l: 3.0, s: 4.0 },
    { name: "Maltese", p: 4.5, l: 0, s: 3.5 },
    { name: "Muscle-up", p: 1.5, l: 1.6, s: 0 }
];

function toggleSimMode() {
    isSimMode = document.getElementById("simMode").checked;
    document.getElementById("mainContainer").classList.toggle('sim-active', isSimMode);
    analyze();
}

function prepareSystem() {
    isSystemReady = true;
    document.getElementById("radar-lock").style.display = "none";
    analyze();
}

function updateLabels() {
    const isMet = document.getElementById("unitSystem").value === 'met';
    document.getElementById("wLabel").innerText = isMet ? "Weight (kg)" : "Weight (lbs)";
    document.getElementById("hMetric").style.display = isMet ? "block" : "none";
    document.getElementById("hImperial").style.display = isMet ? "none" : "block";
}

function initChart() {
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: skills.map(s => s.name),
            datasets: [
                { label: 'Reality', data: [], backgroundColor: 'rgba(76, 111, 255, 0.2)', borderColor: '#4c6fff', borderWidth: 2 },
                { label: 'Potential', data: [], backgroundColor: 'rgba(0, 255, 204, 0.05)', borderColor: '#00ffcc', borderDash: [5, 5] }
            ]
        },
        options: { 
            responsive: true, maintainAspectRatio: false,
            scales: { r: { beginAtZero: true, max: 100, ticks: { display: false }, grid: { color: '#2a2a3a' } } }, 
            plugins: { legend: { display: false } } 
        }
    });
}

function analyze() {
    if(!isSystemReady) return; 
    if(!radarChart) initChart();

    try {
        const sys = document.getElementById("unitSystem").value;
        const conv = sys === 'imp' ? 0.453592 : 1;
        const u = sys === 'met' ? 'kg' : 'lbs';
        
        let bw = (parseFloat(document.getElementById("weight").value) || 75) * conv;
        let h = sys === 'met' ? (parseFloat(document.getElementById("hCm").value) || 170) : ((parseFloat(document.getElementById("hFt").value)||5)*30.48)+((parseFloat(document.getElementById("hIn").value)||7)*2.54);

        const pull1RM = (bw + (parseFloat(document.getElementById("wpW").value)||0)*conv * (1 + (parseInt(document.getElementById("wpR").value)||0)/30)) / bw;
        const push1RM = (bw + (parseFloat(document.getElementById("wdW").value)||0)*conv * (1 + (parseInt(document.getElementById("wdR").value)||0)/30)) / bw;
        const sa1RM = (bw + (parseFloat(document.getElementById("saW").value)||0)*conv * (1 + (parseInt(document.getElementById("saR").value)||0)/30)) / bw;

        const torqueFactor = Math.pow(h / 170, 2.3) * (parseFloat(document.getElementById("legRatio").value) || 1.0);
        const cnsVal = (parseInt(document.getElementById("cns").value) || 10) / 10;
        const form = parseFloat(document.getElementById("form").value) || 1.0;

        let skillPanel = document.getElementById("skillBars");
        if (!document.getElementById("goalSelect")) {
            skillPanel.innerHTML = `<label style="color:var(--primary); font-size:0.7em; letter-spacing:2px;">MISSION_TARGET</label>
            <select id="goalSelect" onchange="analyze()" style="background:#111; color:#fff; width:100%; border:1px solid #333; padding:10px; border-radius:5px; margin:5px 0 15px 0;">
                <option value="None">No Active Goal</option>${skills.map(s => `<option value="${s.name}">${s.name}</option>`).join('')}
            </select><div id="barContainer"></div>`;
        }

        const activeGoal = document.getElementById("goalSelect").value;
        let barHtml = ""; const curScores = []; const potScores = [];

        skills.forEach(s => {
            let vectors = [];
            if (s.p > 0) vectors.push({ val: (push1RM / (s.p * torqueFactor)) * 100 });
            if (s.l > 0) vectors.push({ val: (pull1RM / (s.l * torqueFactor)) * 100 });
            if (s.s > 0) vectors.push({ val: (sa1RM / (s.s * torqueFactor)) * 100 });
            
            const sig = (x) => 100 / (1 + Math.exp(-0.15 * (x - 52)));
            let minVal = Math.min(...vectors.map(v => v.val));
            let cur = sig(minVal) * cnsVal * form;
            
            curScores.push(cur.toFixed(1));
            potScores.push(sig(Math.max(...vectors.map(v => v.val))).toFixed(1));

            barHtml += `
                <div class="skill-bar-container" style="opacity: ${activeGoal !== "None" && s.name !== activeGoal ? '0.2' : '1'}; transition: 0.3s;">
                    <div class="skill-label"><span>${s.name.toUpperCase()}</span><span>${cur.toFixed(0)}%</span></div>
                    <div class="bar-bg"><div class="bar-fill" style="width: ${cur}%"></div></div>
                </div>`;
        });

        const tax = ((torqueFactor - 1) * 100).toFixed(1);
        document.getElementById("aiFeedback").innerHTML = `<h3 style="font-size:0.7em; color:var(--primary); border-bottom:1px solid #333; padding-bottom:10px;">DIAGNOSTIC_REPORT</h3>
            <div style="font-size:0.85em; margin:10px 0; font-family:monospace;">REL_FORCE: <span style="color:var(--potential)">${push1RM.toFixed(2)}x BW</span></div>
            <div style="font-size:0.85em; margin:10px 0; font-family:monospace;">LEVER_TAX: <span style="color:var(--danger)">+${tax}%</span></div>`;
        
        document.getElementById("barContainer").innerHTML = barHtml;

        document.getElementById("reportCard").style.display = "block";
        document.getElementById("shareBtn").style.display = "block";
        document.getElementById("cardTax").innerText = "+" + tax + "%";
        document.getElementById("cardPower").innerText = push1RM.toFixed(2) + "x";
        document.getElementById("cardRank").innerText = "STATUS: " + (push1RM > 2.0 ? "ELITE_ATHLETE" : "ACTIVE_RECRUIT");

        radarChart.data.datasets[0].data = curScores;
        radarChart.data.datasets[1].data = potScores;
        radarChart.update();
        if (!isSimMode) saveToLocal();
    } catch (e) { console.error("ANALYSIS_ERROR:", e); }
}

function shareReport() {
    const report = document.getElementById("reportCard");
    const btn = document.getElementById("shareBtn");
    btn.innerText = "GENERATING...";
    html2canvas(report, { backgroundColor: "#000", scale: 2 }).then(canvas => {
        const link = document.createElement('a');
        link.download = 'CaliBiotech_Athlete_Report.png';
        link.href = canvas.toDataURL();
        link.click();
        btn.innerText = "DOWNLOAD_REPORT.PNG";
    });
}

function saveToLocal() {
    const data = {};
    document.querySelectorAll('input, select').forEach(i => { if(i.id) data[i.id] = i.value; });
    localStorage.setItem('caliData', JSON.stringify(data));
}

function loadSavedData() {
    const saved = localStorage.getItem('caliData');
    if (saved) {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = data[id]; });
        updateLabels();
    }
}

function logSession() {
    const u = document.getElementById("unitSystem").value === 'met' ? 'kg' : 'lbs';
    const entry = {
        date: new Date().toLocaleDateString(),
        bw: document.getElementById("weight").value + u,
        pull: document.getElementById("wpW").value + u,
        push: document.getElementById("wdW").value + u,
        sa: document.getElementById("saW").value + u,
        skill: document.getElementById("goalSelect") ? document.getElementById("goalSelect").value : "None"
    };
    const logs = JSON.parse(localStorage.getItem('caliLogs') || "[]");
    logs.unshift(entry);
    localStorage.setItem('caliLogs', JSON.stringify(logs.slice(0, 8)));
    renderLogs();
}

function renderLogs() {
    const logs = JSON.parse(localStorage.getItem('caliLogs') || "[]");
    document.getElementById("logBody").innerHTML = logs.map((l, i) => `
        <tr>
            <td>${l.date}</td><td>${l.bw}</td><td>${l.pull}</td><td>${l.push}</td><td>${l.sa}</td><td style="color:var(--potential)">${l.skill}</td>
            <td><button onclick="deleteLog(${i})" style="background:none; border:none; color:var(--danger); cursor:pointer;">✕</button></td>
        </tr>`).join('');
}

function deleteLog(i) {
    const logs = JSON.parse(localStorage.getItem('caliLogs'));
    logs.splice(i, 1);
    localStorage.setItem('caliLogs', JSON.stringify(logs));
    renderLogs();
}
</script>
</body>
</html>