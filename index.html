<!DOCTYPE html>
<html>
<head>
  <title>Cali-Biotech: Production Command</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --primary: #4c6fff; --potential: #00ffcc; --bg: #0b0b12; --card: #161621; --border: #2a2a3a; --danger: #ff4c4c; --text: #e0e0e0; }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display:flex; flex-direction:column; align-items:center; padding:10px; margin:0; }
    .container { background:var(--card); padding:20px; border-radius:24px; width:100%; max-width:1300px; box-shadow:0 30px 60px rgba(0,0,0,0.8); border: 1px solid var(--border); box-sizing: border-box; transition: 0.3s; }
    .main-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; }
    .card { background: #1f1f2e; padding: 18px; border-radius: 16px; border: 1px solid #333; }
    .card h3 { margin-top: 0; color: var(--primary); font-size: 0.75em; text-transform: uppercase; margin-bottom: 12px; border-bottom: 1px solid #333; padding-bottom: 5px; }
    label { display:block; margin-top:8px; font-size: 0.65em; color: #888; text-transform: uppercase; font-weight: bold;}
    input, select { width:100%; padding:10px; margin-top:4px; border-radius:8px; border:1px solid #333; background:var(--bg); color:white; font-size: 0.85em; box-sizing: border-box; transition: 0.3s; }
    .inline-quad { display: grid; grid-template-columns: 1.2fr 0.8fr 0.8fr 1fr; gap: 5px; }
    .dashboard-row { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 20px; margin-top: 30px; align-items: start; }
    .analysis-panel { background:#1f1f2e; padding:20px; border-radius:20px; border: 1px solid #333; min-height: 450px; overflow-y: auto; position: relative;}
    .prepare-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(22, 22, 33, 0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 10; border-radius: 20px; text-align: center; padding: 20px; box-sizing: border-box; }
    .btn-prepare { background: transparent; color: var(--potential); border: 2px solid var(--potential); padding: 15px 30px; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 0.8em; letter-spacing: 2px; transition: 0.3s; }
    .btn-prepare:hover { background: var(--potential); color: black; box-shadow: 0 0 20px rgba(0, 255, 204, 0.4); }
    .skill-bar-container { margin-bottom: 12px; transition: 0.3s opacity; }
    .skill-label { display: flex; justify-content: space-between; font-size: 0.75em; margin-bottom: 4px; font-weight: bold; }
    .bar-bg { background: #0b0b12; height: 8px; border-radius: 4px; overflow: hidden; border: 1px solid #333; }
    .bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--potential)); transition: width 0.5s ease; }
    .rec-exercise { font-size: 0.6em; color: var(--potential); margin-top: 3px; display: block; font-style: italic; opacity: 0.8; }
    .insight-block { margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid #2a2a3a; }
    .insight-title { font-weight: bold; color: var(--potential); font-size: 0.85em; display: block; margin-bottom: 4px; }
    .col-header { font-size: 0.5em; color: var(--primary); text-align: center; }
    .sim-active input, .sim-active select { border-color: var(--potential) !important; box-shadow: 0 0 10px rgba(0, 255, 204, 0.1); }
    .sim-toggle-container { text-align: center; margin-bottom: 20px; padding: 10px; border-radius: 50px; background: rgba(0, 255, 204, 0.05); display: inline-block; border: 1px solid rgba(0, 255, 204, 0.1); }
    .blog-section { width: 100%; max-width: 1300px; margin-top: 40px; padding: 20px; box-sizing: border-box; border-top: 1px solid var(--border); text-align: left; }
    .blog-link { color: var(--potential); text-decoration: none; font-size: 0.8em; margin-right: 20px; transition: 0.3s; }
    .blog-link:hover { color: white; text-decoration: underline; }
    table { width: 100%; font-size: 0.75em; border-collapse: collapse; margin-top: 10px; color: #bbb; }
    th { color: var(--primary); text-align: left; padding: 10px; border-bottom: 1px solid #333; text-transform: uppercase; font-size: 0.7em; }
    td { padding: 10px; border-bottom: 1px solid #222; }
    .btn-log { background: var(--primary); color: white; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.7em; transition: 0.3s; }
    .heatmap-container { background: #1f1f2e; padding: 15px; border-radius: 20px; border: 1px solid #333; text-align: center; margin-top: 20px; }
    .joint { transition: fill 0.4s ease; fill: #444; }
    .volume-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
    .stat-box { background: #0b0b12; padding: 10px; border-radius: 12px; border: 1px solid #333; text-align: center; }
    .stat-val { display: block; font-size: 1.1em; font-weight: bold; color: var(--potential); }
    .stat-label { font-size: 0.55em; color: #888; text-transform: uppercase; letter-spacing: 1px; }
    .battery-bar { width: 100%; height: 8px; background: #333; border-radius: 4px; margin-top: 8px; overflow: hidden; }
    .battery-fill { height: 100%; background: var(--potential); transition: width 0.5s; width: 0%; }
    @media (max-width: 1000px) { .dashboard-row { grid-template-columns: 1fr; } .main-grid { grid-template-columns: 1fr; } #chart-card { order: -1; } }
  </style>
</head>
<body onload="loadSavedData(); renderLogs();"> 
<div class="container" id="mainContainer">
    <h1 style="text-align:center; color:var(--primary); font-size:1.4em; letter-spacing:4px; margin-bottom: 20px;">CALI-BIOTECH COMMAND</h1>

    <div style="text-align: center; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; gap: 15px;">
        <select id="unitSystem" onchange="updateLabels(); analyze(); saveToLocal();" style="width: 220px; background: #1f1f2e; color: var(--primary); border: 1px solid var(--primary);">
            <option value="met">METRIC (KG / CM)</option>
            <option value="imp">IMPERIAL (LBS / FT-IN)</option>
        </select>
        <div class="sim-toggle-container">
            <label style="cursor:pointer; display: flex; align-items: center; gap: 10px; padding: 0 15px;">
                <input type="checkbox" id="simMode" onchange="toggleSimMode()" style="width: auto; margin: 0;">
                <span style="color:var(--potential); font-size: 0.7em; letter-spacing: 2px; font-weight: bold;">ACTIVATE BIOTEST SIMULATION</span>
            </label>
        </div>
    </div>

    <div class="main-grid">
        <div class="card">
            <h3>Structure & Readiness</h3>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label id="wLabel">Weight (kg)</label><input type="number" id="weight" value="75" oninput="analyze();"></div>
                <div id="hMetric"><label>Height (cm)</label><input type="number" id="hCm" value="175" oninput="analyze();"></div>
                <div id="hImperial" style="display:none;"><label>Height (ft/in)</label>
                    <div style="display:flex; gap:5px;"><input type="number" id="hFt" value="5" oninput="analyze();"><input type="number" id="hIn" value="9" oninput="analyze();"></div>
                </div>
            </div>
            <label>Surface Stability</label>
            <select id="surface" onchange="analyze();"><option value="1.0">Stable (Floor)</option><option value="1.25">Unstable (Rings)</option></select>
            <label>CNS Readiness</label>
            <input type="range" id="cns" min="1" max="10" value="9" oninput="analyze();">
        </div>

        <div class="card">
            <h3>BW Basics & Skills</h3>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label>Max Pullups</label><input type="number" id="pullups" value="15" oninput="analyze();"></div>
                <div><label>Max Pushups</label><input type="number" id="pushups" value="35" oninput="analyze();"></div>
            </div>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label>Muscle-Ups</label><input type="number" id="mu" value="5" oninput="analyze();"></div>
                <div><label>Dead Hang (s)</label><input type="number" id="hang" value="60" oninput="analyze();"></div>
            </div>
            <div class="inline-quad" style="grid-template-columns: 1.2fr 0.8fr;">
                <div><label>Leg Inertia</label><select id="legRatio" onchange="analyze();"><option value="0.95">Short</option><option value="1.0" selected>Neutral</option><option value="1.1">Long/Heavy</option></select></div>
                <div><label>Form</label><select id="form" onchange="analyze();"><option value="1.0">Elite</option><option value="0.7">Piked</option></select></div>
            </div>
        </div>

        <div class="card">
            <h3>Weighted Matrix</h3>
            <div class="inline-quad"><div class="col-header">Weight</div><div class="col-header">Reps</div><div class="col-header">Sets</div><div class="col-header">RPE</div></div>
            <label id="pullLabel">Weighted Pull-up</label>
            <div class="inline-quad"><input type="number" id="wpW" value="25" oninput="analyze();"><input type="number" id="wpR" value="5" oninput="analyze();"><input type="number" id="wpS" value="3" oninput="analyze();"><input type="number" id="wpRPE" value="8" oninput="analyze();"></div>
            <label id="dipLabel">Weighted Dip</label>
            <div class="inline-quad"><input type="number" id="wdW" value="35" oninput="analyze();"><input type="number" id="wdR" value="5" oninput="analyze();"><input type="number" id="wdS" value="3" oninput="analyze();"><input type="number" id="wdRPE" value="8" oninput="analyze();"></div>
            <label id="zanLabel">Zanetti Raise (SA)</label>
            <div class="inline-quad"><input type="number" id="saW" value="12" oninput="analyze();"><input type="number" id="saR" value="8" oninput="analyze();"><input type="number" id="saS" value="3" oninput="analyze();"><input type="number" id="saRPE" value="9" oninput="analyze();"></div>
        </div>
    </div>

    <div class="dashboard-row">
        <div id="chart-card" style="background:var(--bg); border-radius:20px; padding:10px; border:1px solid var(--border); display: flex; align-items:center; min-height: 300px; position: relative;">
            <div id="radar-lock" class="prepare-overlay"><button class="btn-prepare" onclick="prepareSystem()">PREPARE TRAINING MATRIX</button></div>
            <canvas id="skillRadar"></canvas>
        </div>
        <div class="analysis-panel" id="skillBars"><div style="text-align: center; color: #444; margin-top: 100px;">SYSTEM OFFLINE</div></div>
        <div class="analysis-panel" id="aiFeedback"><div style="text-align: center; color: #444; margin-top: 100px;">AWAITING AUDIT</div></div>
    </div>

    <div class="heatmap-container">
        <h3 style="font-size:0.7em; color:var(--primary); margin-bottom:10px; letter-spacing: 1px;">INJURY RISK HEATMAP</h3>
        <svg width="120" height="180" viewBox="0 0 100 150">
            <circle cx="50" cy="20" r="10" class="joint" /> 
            <line x1="50" y1="30" x2="50" y2="80" stroke="#333" stroke-width="4" /> 
            <line x1="50" y1="40" x2="20" y2="60" stroke="#333" stroke-width="3" /> 
            <line x1="20" y1="60" x2="10" y2="90" stroke="#333" stroke-width="3" /> 
            <line x1="50" y1="40" x2="80" y2="60" stroke="#333" stroke-width="3" /> 
            <line x1="80" y1="60" x2="90" y2="90" stroke="#333" stroke-width="3" /> 
            <circle id="joint-shoulder-l" cx="35" cy="40" r="5" class="joint" /> <circle id="joint-shoulder-r" cx="65" cy="40" r="5" class="joint" />
            <circle id="joint-elbow-l" cx="20" cy="60" r="5" class="joint" /> <circle id="joint-elbow-r" cx="80" cy="60" r="5" class="joint" />
            <circle id="joint-wrist-l" cx="10" cy="90" r="4" class="joint" /> <circle id="joint-wrist-r" cx="90" cy="90" r="4" class="joint" />
        </svg>
        <p id="risk-msg" style="font-size:0.65em; color:#888; margin-top:10px; font-weight: bold;">SCANNINING BIOMETRICS...</p>
    </div>

    <div class="card" style="margin-top: 20px;">
        <h3>Volume & Recovery Optimizer</h3>
        <div class="volume-grid">
            <div class="stat-box"><span class="stat-label">Weekly Volume Tax</span><span id="volume-tax" class="stat-val">0</span><div class="battery-bar"><div id="volume-fill" class="battery-fill"></div></div></div>
            <div class="stat-box"><span class="stat-label">Recovery Window</span><span id="recovery-status" class="stat-val">OPTIMAL</span></div>
        </div>
        <p id="volume-advice" style="font-size: 0.65em; color: #888; margin-top: 10px; text-align: center;">Ready for high-intensity loading.</p>
    </div>

    <div class="card" style="margin-top: 25px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="border: none; margin: 0;">Training History Log</h3>
            <button class="btn-log" onclick="logSession()">LOG CURRENT DATA</button>
        </div>
        <div style="overflow-x: auto;"><table id="logTable"><thead><tr><th>Date</th><th>BW</th><th>Pull Max</th><th>Push Max</th><th>SA Max</th><th>Strongest Skill</th><th></th></tr></thead><tbody id="logBody"></tbody></table></div>
    </div>
</div>

<script>
let isSystemReady = false;
let isSimMode = false;
let radarChart;
const ctx = document.getElementById('skillRadar').getContext('2d');

const skills = [
    { name: "Full Planche", p: 3.4, l: 0, s: 2.5, minEntry: 45 },
    { name: "Straddle Planche", p: 2.8, l: 0, s: 2.0, minEntry: 30 },
    { name: "Front Lever", p: 0, l: 2.6, s: 1.8, minEntry: 30 },
    { name: "Iron Cross", p: 0, l: 3.0, s: 4.0, minEntry: 50 },
    { name: "Maltese", p: 4.5, l: 0, s: 3.5, minEntry: 55 },
    { name: "Muscle-up", p: 1.5, l: 1.6, s: 0, minEntry: 15 }
];

const recs = { "Full Planche": "Planche Leans", "Straddle Planche": "Tuck Holds", "Front Lever": "Scap Pulls", "Iron Cross": "Rings Fly", "Maltese": "Zanetti Press", "Muscle-up": "High Pulls" };

function toggleSimMode() {
    isSimMode = document.getElementById("simMode").checked;
    if (!isSimMode) loadSavedData();
    analyze();
}

function prepareSystem() {
    isSystemReady = true;
    document.getElementById("radar-lock").style.display = "none";
    initChart();
    analyze();
}

function updateLabels() {
    const isMet = document.getElementById("unitSystem").value === 'met';
    document.getElementById("wLabel").innerText = isMet ? "Weight (kg)" : "Weight (lbs)";
    document.getElementById("hMetric").style.display = isMet ? "block" : "none";
    document.getElementById("hImperial").style.display = isMet ? "none" : "block";
}

function initChart() {
    if(radarChart) return;
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: skills.map(s => s.name),
            datasets: [
                { label: 'Reality', data: [], backgroundColor: 'rgba(76, 111, 255, 0.2)', borderColor: '#4c6fff', borderWidth: 2 },
                { label: 'Potential', data: [], backgroundColor: 'rgba(0, 255, 204, 0.05)', borderColor: '#00ffcc', borderDash: [5, 5] }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { r: { beginAtZero: true, max: 100, ticks: { display: false }, grid: { color: '#2a2a3a' } } }, plugins: { legend: { display: false } } }
    });
}

function generateGoalBrief(vectors, bw, conv, u) {
    let bottlenecks = [...vectors].sort((a, b) => a.val - b.val).slice(0, 2);
    let brief = `<div style="margin-top: 8px; font-size: 0.6em; color: var(--potential); font-weight: bold; text-transform: uppercase;">Mission Requirements:</div>`;
    
    bottlenecks.forEach(b => {
        let targetTotalWeight = b.req * bw;
        let currentTotalWeight = b.raw * bw;
        let gapRaw = (targetTotalWeight - currentTotalWeight) / conv;
        
        let exName = b.name === "Push" ? "Weighted Dip" : b.name === "Pull" ? "Weighted Pull-up" : "Zanetti Raise";
        let gapFinal = b.name === "SA Strength" ? gapRaw / 2 : gapRaw;
        let equip = b.name === "SA Strength" ? "per dumbbell" : "to belt/bar";

        brief += `<span class="rec-exercise" style="opacity:1">â†‘ **${exName}**: Add +${Math.max(0, gapFinal).toFixed(1)}${u} ${equip}</span>`;
    });
    return brief;
}

function analyze() {
    if(!isSystemReady) return;
    const sys = document.getElementById("unitSystem").value;
    const conv = sys === 'imp' ? 0.453592 : 1;
    const u = sys === 'met' ? 'kg' : 'lbs';
    let bw = parseFloat(document.getElementById("weight").value) * conv;
    let h = sys === 'met' ? parseFloat(document.getElementById("hCm").value) : (parseFloat(document.getElementById("hFt").value)*30.48)+(parseFloat(document.getElementById("hIn").value)*2.54);
    
    const get1RM = (idW, idR, idRPE) => (bw + (parseFloat(document.getElementById(idW).value)||0)*conv * (1 + (parseInt(document.getElementById(idR).value)||0)/30) * (1+(10-parseInt(document.getElementById(idRPE).value))/18)) / bw;
    
    const pull1RM = get1RM("wpW", "wpR", "wpRPE");
    const push1RM = get1RM("wdW", "wdR", "wdRPE");
    const sa1RM = get1RM("saW", "saR", "saRPE");

    const torqueFactor = Math.pow(h / 170, 2.3) * parseFloat(document.getElementById("legRatio").value);
    const form = parseFloat(document.getElementById("form").value);
    
    let skillPanel = document.getElementById("skillBars");
    if (!document.getElementById("goalSelect")) {
        skillPanel.innerHTML = `<label>Target Goal</label><select id="goalSelect" onchange="analyze()"><option value="None">None</option>${skills.map(s => `<option value="${s.name}">${s.name}</option>`).join('')}</select><div id="barContainer"></div>`;
    }

    const activeGoal = document.getElementById("goalSelect").value;
    let barHtml = "";
    const curScores = [];

    skills.forEach(s => {
        let vectors = [];
        if (s.p > 0) vectors.push({ name: "Push", val: (push1RM / (s.p * torqueFactor)) * 100, raw: push1RM, req: s.p * torqueFactor });
        if (s.l > 0) vectors.push({ name: "Pull", val: (pull1RM / (s.l * torqueFactor)) * 100, raw: pull1RM, req: s.l * torqueFactor });
        if (s.s > 0) vectors.push({ name: "SA Strength", val: (sa1RM / (s.s * torqueFactor)) * 100, raw: sa1RM, req: s.s * torqueFactor });
        
        let cur = (100 / (1 + Math.exp(-0.15 * (Math.min(...vectors.map(v => v.val)) - 58)))) * form;
        curScores.push(cur.toFixed(1));

        const isLocked = cur < s.minEntry && !isSimMode;
        const opacity = (activeGoal !== "None" && s.name !== activeGoal) ? "0.2" : "1";

        barHtml += `<div class="skill-bar-container" style="opacity: ${opacity}">
            <div class="skill-label"><span>${s.name}</span><span>${cur.toFixed(0)}%</span></div>
            <div class="bar-bg"><div class="bar-fill" style="width: ${cur}%"></div></div>
            ${s.name === activeGoal ? generateGoalBrief(vectors, bw, conv, u) : `<span class="rec-exercise">${isLocked ? 'LOCKED' : recs[s.name]}</span>`}
        </div>`;
    });

    radarChart.data.datasets[0].data = curScores;
    radarChart.update();
    document.getElementById("barContainer").innerHTML = barHtml;
    updateAudit(pull1RM, push1RM, sa1RM, torqueFactor, h);
}

function updateAudit(pull, push, sa, torque, h) {
    const ratio = (pull / push).toFixed(2);
    const integrity = (sa / push).toFixed(2);
    document.getElementById("aiFeedback").innerHTML = `<h3>Audit</h3><p>Torque: ${torque.toFixed(2)}x</p><p>Ratio: ${ratio}</p><p>SA Integrity: ${integrity}</p>`;
}

function saveToLocal() { if(!isSimMode) { const d = {}; document.querySelectorAll('input, select').forEach(i => d[i.id] = i.value); localStorage.setItem('caliData', JSON.stringify(d)); } }
function loadSavedData() { const s = localStorage.getItem('caliData'); if(s) { const d = JSON.parse(s); Object.keys(d).forEach(k => { if(document.getElementById(k)) document.getElementById(k).value = d[k]; }); updateLabels(); } }
function logSession() { alert("Session Logged to Local History."); }
function renderLogs() { document.getElementById("logBody").innerHTML = "<tr><td colspan='7' style='text-align:center'>No logs found.</td></tr>"; }
</script>
</body>
</html>