<!DOCTYPE html>
<html lang="en">
<head>
  <title>Cali-Biotech: Production Command</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { 
      --primary: #4c6fff; 
      --potential: #00ffcc; 
      --bg: #0b0b12; 
      --card: #161621; 
      --border: #2a2a3a; 
      --danger: #ff4c4c; 
      --text: #e0e0e0; 
      --accent: #ffdd00;
    }
    
    body { font-family: 'Inter', system-ui, -apple-system, sans-serif; background: var(--bg); color: var(--text); display:flex; flex-direction:column; align-items:center; padding:10px; margin:0; line-height: 1.5; }
    
    .container { background:var(--card); padding:20px; border-radius:24px; width:100%; max-width:1300px; box-shadow:0 30px 60px rgba(0,0,0,0.8); border: 1px solid var(--border); box-sizing: border-box; }
    
    .main-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 15px; }
    
    .card { background: #1f1f2e; padding: 18px; border-radius: 16px; border: 1px solid #333; transition: border-color 0.3s ease; }
    .card:focus-within { border-color: var(--primary); }
    .card h3 { margin-top: 0; color: var(--primary); font-size: 0.85em; text-transform: uppercase; margin-bottom: 12px; border-bottom: 1px solid #333; padding-bottom: 5px; letter-spacing: 1px; }
    
    label { display:block; margin-top:8px; font-size: 0.65em; color: #888; text-transform: uppercase; font-weight: bold;}
    input, select { width:100%; padding:10px; margin-top:4px; border-radius:8px; border:1px solid #333; background:var(--bg); color:white; font-size: 0.85em; box-sizing: border-box; outline: none; }
    input:focus { border-color: var(--potential); }
    
    .inline-quad { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; align-items: end; }
    .dashboard-row { display: grid; grid-template-columns: 1.2fr 1fr 1fr; gap: 20px; margin-top: 30px; }
    
    .analysis-panel { background:#1f1f2e; padding:20px; border-radius:20px; border: 1px solid #333; height: 450px; overflow-y: auto; }
    
    .skill-bar-container { margin-bottom: 15px; }
    .skill-label { display: flex; justify-content: space-between; font-size: 0.75em; margin-bottom: 4px; font-weight: bold; }
    .bar-bg { background: #0b0b12; height: 10px; border-radius: 5px; overflow: hidden; border: 1px solid #333; }
    .bar-fill { height: 100%; background: linear-gradient(90deg, var(--primary), var(--potential)); transition: width 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
    .rec-exercise { font-size: 0.65em; color: var(--potential); margin-top: 4px; display: block; font-style: italic; }
    
    .insight-block { margin-bottom: 18px; padding: 12px; background: rgba(0,0,0,0.2); border-radius: 10px; border-left: 3px solid var(--primary); }
    .insight-title { font-size: 0.8em; font-weight: bold; color: var(--potential); display: block; margin-bottom: 4px; }
    .col-header { font-size: 0.55em; color: var(--primary); text-align: center; font-weight: 800; }

    table { width: 100%; font-size: 0.75em; border-collapse: collapse; margin-top: 10px; color: #bbb; }
    th { color: var(--primary); text-align: left; padding: 12px; border-bottom: 1px solid #333; text-transform: uppercase; font-size: 0.7em; }
    td { padding: 12px; border-bottom: 1px solid #222; }
    
    .btn-log { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 0.75em; transition: 0.3s; }
    .btn-log:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(76, 111, 255, 0.4); }

    @media (max-width: 1000px) {
        .dashboard-row { grid-template-columns: 1fr; }
        .main-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body onload="loadSavedData(); analyze(); renderLogs();">

<div class="container">
    <h1 style="text-align:center; color:var(--primary); font-size:1.6em; letter-spacing:6px; margin-bottom: 25px;">CALI-BIOTECH <span style="color:white">COMMAND</span></h1>

    <div style="text-align: center; margin-bottom: 25px;">
        <select id="unitSystem" onchange="updateLabels(); analyze(); saveToLocal();" style="width: 240px; background: #1f1f2e; color: var(--potential); border: 1px solid var(--primary); font-weight: bold;">
            <option value="met">METRIC (KG / CM)</option>
            <option value="imp">IMPERIAL (LBS / FT-IN)</option>
        </select>
    </div>

    <div class="main-grid">
        <div class="card">
            <h3>Structure & Readiness</h3>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label id="wLabel">Weight (kg)</label><input type="number" id="weight" value="75" step="0.1" oninput="analyze(); saveToLocal();"></div>
                <div id="hMetric"><label>Height (cm)</label><input type="number" id="hCm" value="175" oninput="analyze(); saveToLocal();"></div>
                <div id="hImperial" style="display:none;"><label>Height (ft/in)</label>
                    <div style="display:flex; gap:5px;"><input type="number" id="hFt" value="5" oninput="analyze(); saveToLocal();"><input type="number" id="hIn" value="9" oninput="analyze(); saveToLocal();"></div>
                </div>
            </div>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                <div>
                    <label>Surface Stability</label>
                    <select id="surface" onchange="analyze(); saveToLocal();"><option value="1.0">Stable (Floor)</option><option value="1.20">Unstable (Rings)</option></select>
                </div>
                <div>
                    <label>CNS Readiness</label>
                    <input type="range" id="cns" min="1" max="10" value="9" oninput="analyze(); saveToLocal();">
                </div>
            </div>
        </div>

        <div class="card">
            <h3>BW Basics & Capacity</h3>
            <div class="inline-quad" style="grid-template-columns: 1fr 1fr;">
                <div><label>Max Pullups</label><input type="number" id="pullups" value="15" oninput="analyze(); saveToLocal();"></div>
                <div><label>Max Pushups</label><input type="number" id="pushups" value="35" oninput="analyze(); saveToLocal();"></div>
            </div>
            <div class="inline-quad" style="grid-template-columns: 1.2fr 0.8fr;">
                <div><label>Leg Inertia</label><select id="legRatio" onchange="analyze(); saveToLocal();"><option value="0.92">Short/Light</option><option value="1.0" selected>Neutral</option><option value="1.15">Long/Heavy</option></select></div>
                <div><label>Form Quality</label><select id="form" onchange="analyze(); saveToLocal();"><option value="1.0">Elite</option><option value="0.75">Piked/Compensated</option></select></div>
            </div>
        </div>

        <div class="card">
            <h3>Weighted Matrix</h3>
            <div class="inline-quad"><div class="col-header">Weight</div><div class="col-header">Reps</div><div class="col-header">Sets</div><div class="col-header">RPE</div></div>
            <label id="pullLabel">Weighted Pull-up (+)</label>
            <div class="inline-quad"><input type="number" id="wpW" value="25" oninput="analyze(); saveToLocal();"><input type="number" id="wpR" value="5" oninput="analyze(); saveToLocal();"><input type="number" id="wpS" value="3" oninput="analyze(); saveToLocal();"><input type="number" id="wpRPE" value="8" oninput="analyze(); saveToLocal();"></div>
            <label id="dipLabel">Weighted Dip (+)</label>
            <div class="inline-quad"><input type="number" id="wdW" value="35" oninput="analyze(); saveToLocal();"><input type="number" id="wdR" value="5" oninput="analyze(); saveToLocal();"><input type="number" id="wdS" value="3" oninput="analyze(); saveToLocal();"><input type="number" id="wdRPE" value="8" oninput="analyze(); saveToLocal();"></div>
            <label id="zanLabel">Zanetti Raise (Single Arm)</label>
            <div class="inline-quad"><input type="number" id="saW" value="12" oninput="analyze(); saveToLocal();"><input type="number" id="saR" value="8" oninput="analyze(); saveToLocal();"><input type="number" id="saS" value="3" oninput="analyze(); saveToLocal();"><input type="number" id="saRPE" value="9" oninput="analyze(); saveToLocal();"></div>
        </div>
    </div>

    <div class="dashboard-row">
        <div style="background:var(--bg); border-radius:20px; padding:15px; border:1px solid var(--border); display: flex; align-items:center; justify-content:center;"><canvas id="skillRadar"></canvas></div>
        <div class="analysis-panel" id="skillBars"></div>
        <div class="analysis-panel" id="aiFeedback"></div>
    </div>

    <div class="card" style="margin-top: 25px; border-color: var(--border);">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <h3 style="border: none; margin: 0;">Biometric Log</h3>
            <button class="btn-log" onclick="logSession()">SNAPSHOT SESSION</button>
        </div>
        <div style="overflow-x: auto;">
            <table>
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>BW</th>
                        <th>Pull 1RM</th>
                        <th>Push 1RM</th>
                        <th>SA 1RM</th>
                        <th>Dominant Skill</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="logBody"></tbody>
            </table>
        </div>
    </div>

    <div style="text-align: center; padding: 40px 20px;">
        <a href="https://www.buymeacoffee.com/CaliBiotech" target="_blank" style="display: inline-flex; align-items: center; background: var(--accent); color: #000; padding: 14px 28px; border-radius: 12px; text-decoration: none; font-weight: bold; font-size: 0.9em; box-shadow: 0 4px 15px rgba(255, 221, 0, 0.3);">
            <img src="https://cdn.buymeacoffee.com/buttons/bmc-new-btn-logo.svg" alt="Buy me a coffee" style="height: 22px; margin-right: 10px;">
            SUPPORT RESEARCH
        </a>
    </div>

    <div class="blog-section" style="border-top: 1px solid #333; padding-top: 20px; display: flex; justify-content: space-between; flex-wrap: wrap; gap: 10px;">
        <div>
            <a href="#" class="blog-link" style="color:var(--potential); text-decoration:none; font-size:0.7em; margin-right:15px;">PULL-UP PATHWAY</a>
            <a href="#" class="blog-link" style="color:var(--potential); text-decoration:none; font-size:0.7em; margin-right:15px;">PLANCHE BIOMECHANICS</a>
            <a href="#" class="blog-link" style="color:var(--potential); text-decoration:none; font-size:0.7em;">PRIVACY</a>
        </div>
        <p style="font-size: 0.6em; color: #555; margin: 0;">© 2026 CALI-BIOTECH COMMAND SYSTEMS. V2.1.0</p>
    </div>
</div>

<script>
let radarChart;
const ctx = document.getElementById('skillRadar').getContext('2d');

const skills = [
    { name: "Full Planche", p: 3.2, l: 0, s: 2.2 },
    { name: "Straddle Planche", p: 2.6, l: 0, s: 1.8 },
    { name: "Front Lever", p: 0, l: 2.4, s: 1.6 },
    { name: "Iron Cross", p: 0, l: 2.8, s: 3.8 },
    { name: "Maltese", p: 4.2, l: 0, s: 3.2 },
    { name: "Muscle-up", p: 1.3, l: 1.4, s: 0 }
];

const recs = {
    "Full Planche": "Planche Leans / Weighted PPPU",
    "Straddle Planche": "Tuck Planche / Side Delt Work",
    "Front Lever": "Scapular Pulls / Adv. Tuck Holds",
    "Iron Cross": "Rings Fly / Assisted Cross Pulls",
    "Maltese": "Zanetti Press / Dumbbell Flys",
    "Muscle-up": "High Pull-ups / Dip Explosiveness"
};

function updateLabels() {
    const isMet = document.getElementById("unitSystem").value === 'met';
    document.getElementById("wLabel").innerText = isMet ? "Weight (kg)" : "Weight (lbs)";
    document.getElementById("hMetric").style.display = isMet ? "block" : "none";
    document.getElementById("hImperial").style.display = isMet ? "none" : "block";
}

function initChart() {
    radarChart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: skills.map(s => s.name),
            datasets: [
                { label: 'Reality', data: [], backgroundColor: 'rgba(76, 111, 255, 0.3)', borderColor: '#4c6fff', borderWidth: 3, pointBackgroundColor: '#4c6fff' },
                { label: 'Potential', data: [], backgroundColor: 'rgba(0, 255, 204, 0.05)', borderColor: '#00ffcc', borderDash: [5, 5], borderWidth: 1 }
            ]
        },
        options: { 
            responsive: true,
            maintainAspectRatio: true,
            scales: { r: { beginAtZero: true, max: 100, ticks: { display: false }, grid: { color: '#2a2a3a' }, angleLines: { color: '#2a2a3a' }, pointLabels: { color: '#888', font: { size: 10 } } } }, 
            plugins: { legend: { display: false } } 
        }
    });
}

function calculate1RM(weight, reps, rpe, bw) {
    if (reps === 0) return bw;
    // Brzycki variation + RPE adjustment
    const base1RM = weight * (36 / (37 - reps));
    const rpeMult = 1 + (10 - rpe) * 0.03;
    return bw + (base1RM * rpeMult);
}

function analyze() {
    if(!radarChart) initChart();
    const sys = document.getElementById("unitSystem").value;
    const conv = sys === 'imp' ? 0.453592 : 1;
    
    let bw = parseFloat(document.getElementById("weight").value) * conv;
    let h = sys === 'met' ? parseFloat(document.getElementById("hCm").value) : (parseFloat(document.getElementById("hFt").value)*30.48)+(parseFloat(document.getElementById("hIn").value)*2.54);
    
    // Core Strength Ratios (Total Weight / Bodyweight)
    const pull1RM = calculate1RM(parseFloat(document.getElementById("wpW").value)*conv || 0, parseInt(document.getElementById("wpR").value)||0, parseInt(document.getElementById("wpRPE").value)||10, bw) / bw;
    const push1RM = calculate1RM(parseFloat(document.getElementById("wdW").value)*conv || 0, parseInt(document.getElementById("wdR").value)||0, parseInt(document.getElementById("wdRPE").value)||10, bw) / bw;
    const sa1RM = calculate1RM(parseFloat(document.getElementById("saW").value)*conv || 0, parseInt(document.getElementById("saR").value)||0, parseInt(document.getElementById("saRPE").value)||10, bw) / bw;

    // Torque penalty based on height (standardized at 170cm)
    const torqueFactor = Math.pow(h / 170, 2.1) * parseFloat(document.getElementById("legRatio").value);
    const cns = parseInt(document.getElementById("cns").value) / 10;
    const form = parseFloat(document.getElementById("form").value);
    
    let barHtml = `<h3 style="color:var(--primary); font-size:0.8em; margin-bottom:15px;">Skill Status & Targets</h3>`;
    const curScores = []; const potScores = [];

    skills.forEach(s => {
        let scores = [];
        if (s.p > 0) scores.push((push1RM / (s.p * torqueFactor * parseFloat(document.getElementById("surface").value))) * 100);
        if (s.l > 0) scores.push((pull1RM / (s.l * torqueFactor)) * 100);
        if (s.s > 0) scores.push((sa1RM / (s.s * torqueFactor)) * 100);
        
        // Sigmoid mapping to feel "realistic"
        const sig = (x) => 100 / (1 + Math.exp(-0.12 * (x - 65)));
        let pot = Math.max(...scores);
        let cur = sig(Math.min(...scores)) * cns * form;
        
        curScores.push(cur.toFixed(1));
        potScores.push(Math.min(100, pot).toFixed(1));
        
        barHtml += `
            <div class="skill-bar-container">
                <div class="skill-label"><span>${s.name}</span><span>${cur.toFixed(0)}%</span></div>
                <div class="bar-bg"><div class="bar-fill" style="width: ${cur}%"></div></div>
                <span class="rec-exercise">Target: ${recs[s.name]}</span>
            </div>`;
    });

    radarChart.data.datasets[0].data = curScores;
    radarChart.data.datasets[1].data = potScores;
    radarChart.update();
    document.getElementById("skillBars").innerHTML = barHtml;

    // AI Logic
    const saRatio = (sa1RM / push1RM);
    let saMsg = saRatio < 0.55 ? "⚠️ TENDON WARNING: Straight-arm strength lagging behind bent-arm. High injury risk in Maltese/Cross." : "✅ SA INTEGRITY: Scapular stabilizers are conditioned for isometric load.";
    
    document.getElementById("aiFeedback").innerHTML = `<h3>Biomechanical Audit</h3>
        <div class="insight-block"><span class="insight-title">Torque Multiplier: ${torqueFactor.toFixed(2)}x</span><p style="font-size:0.7em;">Geometric disadvantage based on height/lever length.</p></div>
        <div class="insight-block"><span class="insight-title">Neural Efficiency: ${(cns*100).toFixed(0)}%</span><p style="font-size:0.7em;">Current CNS output vs absolute potential.</p></div>
        <div class="insight-block"><p style="font-size:0.7em; color:${saRatio < 0.55 ? 'var(--danger)' : '#888'}">${saMsg}</p></div>`;
}

function saveToLocal() {
    const inputs = document.querySelectorAll('input, select');
    const data = {};
    inputs.forEach(input => { data[input.id] = input.value; });
    localStorage.setItem('caliDataV2', JSON.stringify(data));
}

function loadSavedData() {
    const saved = localStorage.getItem('caliDataV2');
    if (saved) {
        const data = JSON.parse(saved);
        Object.keys(data).forEach(id => { if(document.getElementById(id)) document.getElementById(id).value = data[id]; });
        updateLabels();
    }
}

function logSession() {
    const savedLogs = localStorage.getItem('caliLogsV2') ? JSON.parse(localStorage.getItem('caliLogsV2')) : [];
    const sys = document.getElementById("unitSystem").value;
    const u = sys === 'met' ? 'kg' : 'lbs';
    const conv = sys === 'imp' ? 0.453592 : 1;
    const bw = parseFloat(document.getElementById("weight").value);
    
    const get1RM = (idW, idR, idRPE) => {
        let w = parseFloat(document.getElementById(idW).value) || 0;
        let r = parseInt(document.getElementById(idR).value) || 0;
        let rpe = parseInt(document.getElementById(idRPE).value) || 10;
        return calculate1RM(w, r, rpe, bw).toFixed(1);
    };

    let topSkill = "None";
    let maxVal = -1;
    document.querySelectorAll('.skill-label').forEach(el => {
        let val = parseInt(el.children[1].innerText);
        if(val > maxVal) { maxVal = val; topSkill = el.children[0].innerText; }
    });

    const entry = {
        date: new Date().toLocaleDateString(),
        bw: bw + u,
        pull: get1RM("wpW", "wpR", "wpRPE") + u,
        push: get1RM("wdW", "wdR", "wdRPE") + u,
        sa: get1RM("saW", "saR", "saRPE") + u,
        skill: topSkill + " (" + maxVal + "%)"
    };

    savedLogs.unshift(entry);
    localStorage.setItem('caliLogsV2', JSON.stringify(savedLogs.slice(0, 10)));
    renderLogs();
}

function renderLogs() {
    const savedLogs = localStorage.getItem('caliLogsV2') ? JSON.parse(localStorage.getItem('caliLogsV2')) : [];
    const container = document.getElementById("logBody");
    container.innerHTML = savedLogs.map((l, i) => `
        <tr>
            <td>${l.date}</td>
            <td>${l.bw}</td>
            <td>${l.pull}</td>
            <td>${l.push}</td>
            <td>${l.sa}</td>
            <td style="color:var(--potential)">${l.skill}</td>
            <td><button onclick="deleteLog(${i})" style="background:none; border:none; color:var(--danger); cursor:pointer;">✕</button></td>
        </tr>
    `).join('');
}

function deleteLog(i) {
    const savedLogs = JSON.parse(localStorage.getItem('caliLogsV2'));
    savedLogs.splice(i, 1);
    localStorage.setItem('caliLogsV2', JSON.stringify(savedLogs));
    renderLogs();
}
</script>
</body>
</html>