<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strength Matrix | Cali-Biotech</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { 
            --primary: #4c6fff; 
            --bg: #0a0a0f; 
            --card: #161625; 
            --accent: #00f2ff;
            --inter: #00ff88;
            --adv-inter: #00a2ff;
            --advanced: #bc62ff;
            --gold: #ffcc00;
            --warning: #ffaa00;
            --delete: #ff4c4c;
        }
        
        body { 
            background-color: var(--bg); 
            color: white; 
            font-family: 'Segoe UI', sans-serif; 
            text-align: center; 
            padding: 20px;
            background-image: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #0a0a0f 100%);
        }

        .power-score-container {
            background: rgba(255, 255, 255, 0.03);
            border: 1px dashed #333;
            padding: 20px;
            border-radius: 15px;
            max-width: 600px;
            margin: 0 auto 40px;
        }
        #globalRank { font-size: 1.8rem; font-weight: 900; color: var(--accent); text-shadow: 0 0 10px rgba(0,242,255,0.3); }

        .calc-container { 
            display: flex; 
            flex-wrap: wrap; 
            justify-content: center; 
            gap: 25px; 
            max-width: 1400px; 
            margin: 0 auto; 
        }

        .card { 
            background: var(--card); 
            padding: 30px; 
            border-radius: 20px; 
            border: 1px solid #2a2a3a; 
            width: 320px; 
            transition: all 0.4s ease;
        }

        .card:hover { border-color: var(--accent); transform: translateY(-5px); }
        .chart-card { width: 450px; display: flex; flex-direction: column; align-items: center; justify-content: center; }

        h2 { color: #fff; font-size: 0.8rem; letter-spacing: 3px; margin-bottom: 20px; text-transform: uppercase; }

        label { display: block; font-size: 0.65rem; color: #aaa; margin-top: 15px; text-align: left; text-transform: uppercase; }

        input, select.goal-select { 
            width: 100%; padding: 12px; margin: 8px 0; border-radius: 8px; 
            border: 1px solid #333; background: #0f0f1a; color: var(--accent); 
            box-sizing: border-box; font-family: monospace; font-size: 1rem; outline: none;
        }

        select.goal-select { color: var(--gold); font-size: 0.7rem; cursor: pointer; }

        .result-box { 
            margin-top: 25px; padding: 20px; background: rgba(0, 0, 0, 0.4); 
            border-radius: 12px; border: 1px solid #2a2a3a; min-height: 120px;
        }

        .val-label { font-size: 0.65rem; color: var(--accent); font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
        .val { font-size: 1.6rem; color: #fff; font-weight: 800; display: block; margin-top: 5px; }
        
        .breakdown-row { display: flex; justify-content: center; border-top: 1px solid #2a2a3a; padding-top: 10px; margin-top: 10px; }
        .b-label { font-size: 0.55rem; color: #777; display: block; text-transform: uppercase; }
        .b-val { font-size: 0.85rem; color: #ccc; font-weight: bold; }

        .target-section { margin-top: 15px; padding-top: 15px; border-top: 1px dashed #333; }

        .lvl-badge { 
            display: inline-block; margin-top: 15px; padding: 6px 12px; 
            font-size: 0.7rem; border-radius: 4px; font-weight: 900; 
            background: #222; color: #fff; letter-spacing: 1px;
        }

        .log-btn {
            width: 100%; margin-top: 15px; padding: 10px; border: 1px solid var(--accent);
            background: transparent; color: var(--accent); border-radius: 8px; cursor: pointer;
            font-family: monospace; font-size: 0.7rem; font-weight: bold; transition: 0.3s;
        }
        .log-btn:hover { background: var(--accent); color: #000; }

        /* LOG TABLE STYLES */
        .log-container {
            max-width: 1200px; margin: 40px auto; background: var(--card);
            border-radius: 20px; border: 1px solid #2a2a3a; overflow: hidden;
        }
        table { width: 100%; border-collapse: collapse; text-align: left; font-size: 0.8rem; }
        th { background: #11111d; padding: 15px; color: var(--accent); text-transform: uppercase; font-size: 0.7rem; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid #222; }
        tr:hover { background: rgba(255,255,255,0.02); }
        .del-entry { color: var(--delete); cursor: pointer; font-weight: bold; background: none; border: none; }

        .neural-warning { font-size: 0.55rem; color: var(--warning); display: none; margin-top: 5px; font-weight: bold; }

        .analysis-box {
            max-width: 800px; margin: 40px auto; padding: 25px;
            background: #11111d; border-radius: 15px; border-left: 5px solid var(--primary);
            text-align: left; display: none;
        }

        .skill-item { margin-bottom: 15px; }
        .progress-bg { background: rgba(255,255,255,0.05); height: 8px; border-radius: 10px; margin-top: 8px; overflow: hidden; border: 1px solid #222; }
        .progress-fill { height: 100%; width: 0%; transition: width 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        .lvl-INTERMEDIATE { background: var(--inter); color: #000; }
        .lvl-ADVANCED-INTERMEDIATE { background: var(--adv-inter); }
        .lvl-ADVANCED { background: var(--advanced); }
        .lvl-ELITE { background: var(--gold); color: #000; box-shadow: 0 0 15px var(--gold); }
    </style>
</head>
<body>

    <div class="power-score-container">
        <div style="font-size: 0.7rem; color: #888; letter-spacing: 2px;">GLOBAL STRENGTH MATRIX INDEX</div>
        <div id="globalRank">RANK: PENDING</div>
    </div>

    <div style="margin-bottom: 30px;">
        <select id="unitSystem" onchange="calcAll()" style="background: var(--card); color: var(--accent); border: 1px solid #333; padding: 10px 20px; border-radius: 50px; cursor: pointer; outline: none;">
            <option value="kg">METRIC (KG)</option>
            <option value="lb">IMPERIAL (LBS)</option>
        </select>
    </div>

    <div class="calc-container">
        <div class="card chart-card">
            <h2>NEURAL SIGNATURE</h2>
            <div style="width: 100%; height: 300px;">
                <canvas id="radarChart"></canvas>
            </div>
            <div style="font-size: 0.55rem; color: #555; margin-top: 15px; letter-spacing: 1px;">NORMALIZED TO ELITE BIOMARKERS</div>
        </div>

        <div class="card">
            <h2>WEIGHTED PULL-UP</h2>
            <label class="u-label">Bodyweight</label>
            <input type="number" id="pbw" value="75" oninput="calcAll()">
            <label class="u-label">Added Weight</label>
            <input type="number" id="padd" placeholder="0" oninput="calcAll()">
            <label>Reps</label>
            <input type="number" id="prep" placeholder="0" oninput="calcAll()">
            <div class="result-box">
                <span class="val-label">Performance 1RM</span>
                <span class="val" id="pRes">READY</span>
                <div id="pWarn" class="neural-warning">! NEURAL FATIGUE: LOW CONFIDENCE</div>
                <div class="target-section">
                    <label style="text-align:center; color:var(--gold);">ROAD TO ELITE</label>
                    <select id="pGoal" class="goal-select" onchange="calcAll()">
                        <option value="0.15">INTERMEDIATE</option>
                        <option value="0.30">ADV. INTERMEDIATE</option>
                        <option value="0.45">ADVANCED</option>
                        <option value="0.65" selected>ELITE</option>
                    </select>
                    <div class="breakdown-row">
                        <div style="margin-right:15px;"><span class="b-label">TARGET</span><span class="b-val" id="pTargetVal" style="color:var(--gold);">--</span></div>
                        <div><span class="b-label">GAP</span><span class="b-val" id="pGap" style="color:var(--accent);">--</span></div>
                    </div>
                </div>
                <div id="pLvl" class="lvl-badge">LEVEL: PENDING</div>
                <button class="log-btn" onclick="log1RM('Weighted Pull-up', 'pRes')">LOG SESSION</button>
            </div>
        </div>

        <div class="card">
            <h2>WEIGHTED DIP</h2>
            <label class="u-label">Bodyweight</label>
            <input type="number" id="dbw" value="75" oninput="calcAll()">
            <label class="u-label">Added Weight</label>
            <input type="number" id="dadd" placeholder="0" oninput="calcAll()">
            <label>Reps</label>
            <input type="number" id="drep" placeholder="0" oninput="calcAll()">
            <div class="result-box">
                <span class="val-label">Performance 1RM</span>
                <span class="val" id="dRes">READY</span>
                <div id="dWarn" class="neural-warning">! NEURAL FATIGUE: LOW CONFIDENCE</div>
                <div class="target-section">
                    <label style="text-align:center; color:var(--gold);">ROAD TO ELITE</label>
                    <select id="dGoal" class="goal-select" onchange="calcAll()">
                        <option value="0.25">INTERMEDIATE</option>
                        <option value="0.40">ADV. INTERMEDIATE</option>
                        <option value="0.60">ADVANCED</option>
                        <option value="0.85" selected>ELITE</option>
                    </select>
                    <div class="breakdown-row">
                        <div style="margin-right:15px;"><span class="b-label">TARGET</span><span class="b-val" id="dTargetVal" style="color:var(--gold);">--</span></div>
                        <div><span class="b-label">GAP</span><span class="b-val" id="dGap" style="color:var(--accent);">--</span></div>
                    </div>
                </div>
                <div id="dLvl" class="lvl-badge">LEVEL: PENDING</div>
                <button class="log-btn" onclick="log1RM('Weighted Dip', 'dRes')">LOG SESSION</button>
            </div>
        </div>

        <div class="card">
            <h2>ZANETTI / SA RAISE</h2>
            <label class="u-label">Bodyweight</label>
            <input type="number" id="zabw" value="75" oninput="calcAll()">
            <label class="u-label">Dumbbell Weight</label>
            <input type="number" id="zaw" placeholder="0" oninput="calcAll()">
            <label>Reps</label>
            <input type="number" id="zar" placeholder="0" oninput="calcAll()">
            <div class="result-box">
                <span class="val-label">Estimated 1RM</span>
                <span class="val" id="zaRes">READY</span>
                <div id="zaLvl" class="lvl-badge">LEVEL: PENDING</div>
                <button class="log-btn" onclick="log1RM('Zanetti Raise', 'zaRes')">LOG SESSION</button>
            </div>
        </div>

        </div>

    <div class="log-container">
        <h2 style="padding: 20px 0 0 20px; text-align: left;">1RM CALIBRATION HISTORY</h2>
        <table id="calibrationLog">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Exercise</th>
                    <th>Max Performance</th>
                    <th>Unit</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="logBody">
                </tbody>
        </table>
    </div>

    <script>
        let radarChart;
        const levelsOrder = ["BEGINNER", "INTERMEDIATE", "ADVANCED INTERMEDIATE", "ADVANCED", "ELITE"];
        const movementWeights = { p: 0.30, d: 0.30, cp: 0.15, sp: 0.15, za: 0.10 };
        const eliteThresholds = { pull: 0.65, dip: 0.85, chest: 1.65, shoulder: 1.10, za: 0.32 };

        // INITIALIZE CHART
        function initChart() {
            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['PULL-UP', 'DIP', 'ZANETTI', 'CHEST', 'SHOULDER'],
                    datasets: [{
                        label: 'Current Signature',
                        data: [0, 0, 0, 0, 0],
                        backgroundColor: 'rgba(0, 242, 255, 0.2)',
                        borderColor: '#00f2ff',
                        borderWidth: 2,
                    }]
                },
                options: {
                    scales: { r: { min: 0, max: 100, ticks: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // LOGGING SYSTEM
        function log1RM(exerciseName, resultId) {
            const resultValue = document.getElementById(resultId).innerText;
            if (resultValue === "READY") return;

            const unit = document.getElementById('unitSystem').value;
            const entry = {
                id: Date.now(),
                date: new Date().toLocaleDateString(),
                exercise: exerciseName,
                value: resultValue.split(' ')[0],
                unit: unit
            };

            let logs = JSON.parse(localStorage.getItem('cali1RMLogs')) || [];
            logs.unshift(entry);
            localStorage.setItem('cali1RMLogs', JSON.stringify(logs));
            renderLogs();
        }

        function renderLogs() {
            const logs = JSON.parse(localStorage.getItem('cali1RMLogs')) || [];
            const tbody = document.getElementById('logBody');
            tbody.innerHTML = logs.map(log => `
                <tr>
                    <td>${log.date}</td>
                    <td>${log.exercise}</td>
                    <td style="color:var(--accent); font-weight:bold;">${log.value}</td>
                    <td>${log.unit}</td>
                    <td><button class="del-entry" onclick="deleteLog(${log.id})">[DEL]</button></td>
                </tr>
            `).join('');
        }

        function deleteLog(id) {
            let logs = JSON.parse(localStorage.getItem('cali1RMLogs')) || [];
            logs = logs.filter(l => l.id !== id);
            localStorage.setItem('cali1RMLogs', JSON.stringify(logs));
            renderLogs();
        }

        // 1RM LOGIC
        function brzycki(w, r) { return r === 1 ? w : w / (1.0278 - (0.0278 * r)); }

        function getLevel(ratio, type) {
            const scales = {
                pull: [0.15, 0.30, 0.45, 0.65], 
                dip:  [0.25, 0.40, 0.60, 0.85],
                za: [0.12, 0.18, 0.25, 0.32]
            };
            const [inter, advInter, adv, elite] = scales[type];
            if (ratio >= elite) return "ELITE";
            if (ratio >= adv) return "ADVANCED";
            if (ratio >= advInter) return "ADVANCED INTERMEDIATE";
            if (ratio >= inter) return "INTERMEDIATE";
            return "BEGINNER";
        }

        function calcAll() {
            const unit = document.getElementById('unitSystem').value;
            let strengthMap = {};

            // PULL & DIP Logic
            ['p', 'd'].forEach(id => {
                let bw = parseFloat(document.getElementById(id + 'bw').value) || 0;
                let add = parseFloat(document.getElementById(id + 'add').value) || 0;
                let reps = parseInt(document.getElementById(id + 'rep').value) || 0;
                let goalRatio = parseFloat(document.getElementById(id + 'Goal').value);
                
                let total1RM = (reps > 0 && bw > 0) ? brzycki(bw + add, reps) : 0;
                let performance1RM = total1RM > 0 ? total1RM - bw : 0;
                
                if (bw > 0) {
                    document.getElementById(id + 'Res').innerText = "+" + performance1RM.toFixed(1) + " " + unit;
                    document.getElementById(id + 'TargetVal').innerText = "+" + (bw * goalRatio).toFixed(1) + unit;
                    let gap = (bw * goalRatio) - performance1RM;
                    document.getElementById(id + 'Gap').innerText = gap > 0 ? "+" + gap.toFixed(1) + unit : "GOAL MET";

                    let ratio = performance1RM / bw;
                    let level = getLevel(ratio, id === 'p' ? 'pull' : 'dip');
                    let lBox = document.getElementById(id + 'Lvl');
                    lBox.innerText = "LEVEL: " + level;
                    lBox.className = "lvl-badge lvl-" + level.replace(/ /g, '-');
                    strengthMap[id] = ratio;
                }
            });

            // ZANETTI Logic
            let zabw = parseFloat(document.getElementById('zabw').value) || 0;
            let zaw = parseFloat(document.getElementById('zaw').value) || 0;
            let zar = parseInt(document.getElementById('zar').value) || 0;
            if (zar > 0 && zaw > 0 && zabw > 0) {
                let za1RM = zaw * (1 + (zar * 0.02));
                document.getElementById('zaRes').innerText = za1RM.toFixed(1) + " " + unit;
                let ratio = za1RM / zabw;
                let level = getLevel(ratio, 'za');
                let lBox = document.getElementById('zaLvl');
                lBox.innerText = "LEVEL: " + level;
                lBox.className = "lvl-badge lvl-" + level.replace(/ /g, '-');
                strengthMap.za = ratio;
            }

            // Chart Update
            if(radarChart) {
                radarChart.data.datasets[0].data = [
                    (strengthMap.p / 0.65) * 100 || 0,
                    (strengthMap.d / 0.85) * 100 || 0,
                    (strengthMap.za / 0.32) * 100 || 0,
                    0, 0
                ];
                radarChart.update();
            }
        }

        window.onload = () => {
            initChart();
            renderLogs();
            calcAll();
        };
    </script>
</body>
</html>