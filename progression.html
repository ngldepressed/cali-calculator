<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ELITE PERFORMANCE LAB</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{background:#0b0f17;color:#e6edf3;font-family:monospace;padding:20px}
h1,h2,h3{color:#4c6fff}
.card{background:#141a24;padding:18px;margin:14px 0;border:1px solid #1f2a3a}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:15px}
input,select,button{
width:100%;padding:8px;margin:5px 0;
background:#000;border:1px solid #4c6fff;color:#4c6fff;font-family:monospace
}
button:hover{background:#4c6fff;color:#000;cursor:pointer}
.small{font-size:12px;opacity:.7}
.stat{display:flex;justify-content:space-between}
</style>
</head>
<body>

<h1>NEURAL PERFORMANCE LAB</h1>

<div class="card">
<h2>Skill Baseline Input</h2>

<div class="grid">
<div>
<label>Planche Progression</label>
<select id="plancheLevel"></select>
<input id="plancheHold" placeholder="Max Hold (sec)">
</div>

<div>
<label>Front Lever Progression</label>
<select id="flLevel"></select>
<input id="flHold" placeholder="Max Hold (sec)">
</div>
</div>
</div>

<div class="card">
<h2>Weekly Recovery Inputs</h2>
<input id="sleep" placeholder="Sleep Hours">
<input id="soreness" placeholder="Muscle Soreness 1-10">
<input id="stress" placeholder="Stress 1-10">
<button onclick="runWeek()">Run Week</button>
<button onclick="prevWeek()">Previous Week</button>
<button onclick="nextWeek()">Next Week</button>
</div>

<div id="dashboard" class="card"></div>
<div id="analysis" class="card"></div>
<canvas id="chart"></canvas>

<script>

/* =======================
   DATABASE GENERATION
======================= */

function generateFamily(name, base){
  const holds=[5,8,10,12,15,20]
  let db=[]
  base.forEach((b,i)=>{
    holds.forEach((h,j)=>{
      db.push({
        id:`${name}_${i}_${h}`,
        family:name,
        base:b,
        required:h,
        tier:i+1,
        prereq: j>0
          ? `${name}_${i}_${holds[j-1]}`
          : i>0
            ? `${name}_${i-1}_${holds[holds.length-1]}`
            : null
      })
    })
  })
  return db
}

const SkillDB=[
  ...generateFamily("Planche",[
    "Lean","Tuck","AdvTuck","Straddle","Full"
  ]),
  ...generateFamily("FrontLever",[
    "Tuck","AdvTuck","Straddle","Full"
  ])
]

/* =======================
   STATE
======================= */

let State={
  week:1,
  fatigue:0,
  phase:"Accumulation",
  history:[]
}

let Athlete={
  mastery:{}
}

/* =======================
   INITIALIZE DROPDOWNS
======================= */

function populateSelect(id,family){
  const sel=document.getElementById(id)
  SkillDB.filter(s=>s.family===family)
  .forEach(s=>{
    let opt=document.createElement("option")
    opt.value=s.id
    opt.textContent=`${s.base} ${s.required}s`
    sel.appendChild(opt)
  })
}

populateSelect("plancheLevel","Planche")
populateSelect("flLevel","FrontLever")

/* =======================
   MASTERY CALCULATION
======================= */

function calculateMastery(skillId,hold){
  const skill=SkillDB.find(s=>s.id===skillId)
  return Math.min((hold/skill.required)*100,150)
}

/* =======================
   READINESS MODEL
======================= */

function readiness(sleep,soreness,stress){
  let sleepFactor=sleep/8
  let fatigueFactor=State.fatigue/100
  let soreFactor=soreness/10
  let stressFactor=stress/10

  return (sleepFactor*0.4)
        - (fatigueFactor*0.3)
        - (soreFactor*0.2)
        - (stressFactor*0.1)
}

/* =======================
   PERIODIZATION
======================= */

function updatePhase(){
  let m=State.week%4
  if(m===1) State.phase="Accumulation"
  if(m===2) State.phase="Intensification"
  if(m===3) State.phase="Peak"
  if(m===0) State.phase="Deload"
}

/* =======================
   WEEK RUN
======================= */

function runWeek(){

  let sleep=parseFloat(sleepInput())||8
  let sore=parseFloat(soreness.value)||3
  let stress=parseFloat(stress.value)||3

  updatePhase()

  let ready=readiness(sleep,sore,stress)

  let plancheId=plancheLevel.value
  let flId=flLevel.value

  let pHold=parseFloat(plancheHold.value)||0
  let flHold=parseFloat(flHold.value)||0

  Athlete.mastery[plancheId]=calculateMastery(plancheId,pHold)
  Athlete.mastery[flId]=calculateMastery(flId,flHold)

  let intensityBase=
    State.phase==="Deload"?0.6:
    State.phase==="Peak"?0.95:
    State.phase==="Intensification"?0.85:0.75

  let intensity=intensityBase*ready

  let trainingLoad=(intensity*10)+(sore*2)

  State.fatigue += trainingLoad
  State.fatigue*=0.92
  if(State.fatigue<0) State.fatigue=0

  State.history.push({
    week:State.week,
    fatigue:State.fatigue,
    readiness:ready
  })

  renderDashboard(ready,intensity)
  renderAnalysis(plancheId,flId,ready,intensity)
  updateChart()

  save()
}

/* =======================
   DASHBOARD
======================= */

function renderDashboard(ready,intensity){
  dashboard.innerHTML=`
  <h2>Performance Dashboard</h2>
  <div class="stat"><span>Week</span><span>${State.week}</span></div>
  <div class="stat"><span>Phase</span><span>${State.phase}</span></div>
  <div class="stat"><span>Fatigue Index</span><span>${State.fatigue.toFixed(1)}</span></div>
  <div class="stat"><span>Readiness Score</span><span>${ready.toFixed(2)}</span></div>
  <div class="stat"><span>Intensity Multiplier</span><span>${intensity.toFixed(2)}</span></div>
  `
}

/* =======================
   ENGINE ANALYSIS
======================= */

function renderAnalysis(plancheId,flId,ready,intensity){

  const pMastery=Athlete.mastery[plancheId]||0
  const flMastery=Athlete.mastery[flId]||0

  analysis.innerHTML=`
  <h2>Engine Analysis</h2>

  1. Planche Mastery: ${pMastery.toFixed(1)}%<br>
  2. Front Lever Mastery: ${flMastery.toFixed(1)}%<br>
  3. Current Phase indicates ${State.phase} emphasis.<br>
  4. Fatigue accumulation trending at ${State.fatigue.toFixed(1)}.<br>
  5. Readiness composite suggests ${ready>0.7?"high neural output":"conservative load management"}.<br>
  6. Soreness contribution increasing tendon load risk.<br>
  7. Stress index influencing CNS recovery rate.<br>
  8. Intensity scaling set at ${(intensity*100).toFixed(0)}% of base wave.<br>
  9. Prerequisite validation active for tier progression.<br>
  10. Auto-deload trigger threshold at fatigue > 85.<br>
  11. Next tier unlock requires >110% mastery.<br>
  12. Recommendation: ${State.fatigue>80?"Reduce volume immediately":"Proceed within structured overload."}
  `
}

/* =======================
   CHART
======================= */

let chart
function updateChart(){
  const ctx=document.getElementById("chart")
  if(chart) chart.destroy()

  chart=new Chart(ctx,{
    type:"line",
    data:{
      labels:State.history.map(h=>h.week),
      datasets:[
        {
          label:"Fatigue",
          data:State.history.map(h=>h.fatigue),
          borderColor:"red"
        },
        {
          label:"Readiness",
          data:State.history.map(h=>h.readiness),
          borderColor:"green"
        }
      ]
    }
  })
}

/* =======================
   WEEK CONTROL
======================= */

function nextWeek(){
  State.week++
  save()
}

function prevWeek(){
  if(State.week>1) State.week--
  save()
}

/* =======================
   HELPERS
======================= */

function sleepInput(){
  return document.getElementById("sleep").value
}

function save(){
  localStorage.setItem("labState",JSON.stringify({State,Athlete}))
}

function load(){
  let data=localStorage.getItem("labState")
  if(data){
    let parsed=JSON.parse(data)
    State=parsed.State
    Athlete=parsed.Athlete
  }
}

load()

</script>
</body>
</html>